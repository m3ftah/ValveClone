<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="my-table">
  <template>
    <style include="shared-styles">
    #sort {
      height: 300px;
    }    
    #filter,#sort{
      margin: 10px;
    }
    @media (max-width: 800px) {
        .table{
        width: 300px;
      }
    }
    @media (min-width: 801px) {
        .table{
        width: 900px;
      }
    }
    </style>
    <div class="table">
    <h4>List of farmers: </h4>
    <paper-input id="filter" label="Filter by first name"></paper-input>
    <vaadin-grid id="sort" selection-mode="multi">
      <table>
        <colgroup>
          <col name="firstName" sortable/>
          <col name="lastName" sortable/>
          <col name="email" sortable/>
        </colgroup>
      </table>
    </vaadin-grid>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'my-table',

        properties: {
          pin :{
            type : String,
            value : 1
          }
        },
        envoyer : function(){
        },
        toggle : function() {
          this.$.collapse.toggle();
        },
        postComplete : function(){
              console.log(this.postResponse);
        },
        ready: function() {

          var grid = this.$.sort;
          var users = [];
          users.push({firstName : 'Brahim',lastName:'Hdaddig',email:'brahim_haddig@gmail.com'});
          users.push({firstName : 'Ali',lastName:'Ghraysa',email:'ali_gh@hotmail.com'});
          users.push({firstName : 'Yacine',lastName:'Attoussi',email:'y_attoussi@hotmail.com'});
          users.push({firstName : 'Hamza',lastName:'Ghraysa',email:'gh_hamza@gmail.com'});

          /*getJSON('https://demo.vaadin.com/demo-data/1.0/people', function(json) {
            users = json.result;
            console.log(users);
            grid.items = users;
          });*/

          grid.items = users;

          grid.addEventListener('sort-order-changed', function() {
            var sortOrder = grid.sortOrder[0];
            var sortProperty = grid.columns[sortOrder.column].name;
            var sortDirection = sortOrder.direction;
            grid.items.sort(function(a, b) {
              var res;
              var path = sortProperty.split('.');
              for (var i = 0; i < path.length; i++) {
                a = a[path[i]];
                b = b[path[i]];
              }
              if (!isNaN(a)) {
                res = parseInt(a, 10) - parseInt(b, 10);
              } else {
                res = a.localeCompare(b);
              }

              if ('desc' === sortDirection) {
                res *= -1;
              }
              return res;
            });
          });

          var filterInput = this.$.filter;
          filterInput.addEventListener('value-changed', function() {
            var filterText = filterInput.value.toLowerCase();
            grid.items = users.filter(function(val) {
              if (filterText) {
                return (val.firstName.toLowerCase()).indexOf(filterText) > -1;
              } else {
                return true;
              }
            });
          });     

          function getJSON(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
              if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                callback(JSON.parse(xhr.responseText));
              }
            };
            xhr.open('GET', url, true);
            xhr.send();
          }
        }
      });
    })();
  </script>
</dom-module>
